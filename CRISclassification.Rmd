---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}

library(readxl)
library(dplyr)
library(org.Hs.eg.db)
library(openxlsx)

#installing all the packages 
new_lib_path <- "C:/Users/Vaishnavi Raikar/Documents/R/win-library/4.3-project"
dir.create(new_lib_path, showWarnings = FALSE, recursive = TRUE)

#setting the custom library path
.libPaths(new_lib_path)

install.packages("BiocManager", lib = new_lib_path)
install.packages("remotes", lib = new_lib_path)

#installing the CMSclassifier from GITHUB 
remotes::install_github("Sage-Bionetworks/CMSclassifier", lib = new_lib_path)

library(BiocManager, lib.loc = new_lib_path)
library(CMSclassifier, lib.loc = new_lib_path)

# Install devtools package if not already installed
if (!requireNamespace("devtools", quietly = TRUE)) {
    install.packages("devtools")
}

# Install CMScaller package from GitHub
devtools::install_github("Lothelab/CMScaller")

# Load necessary libraries
library(CMScaller)

```

```{r}

if (!requireNamespace("writexl", quietly = TRUE)) install.packages("writexl")
if (!requireNamespace("readxl", quietly = TRUE)) install.packages("readxl")
if (!requireNamespace("openxlsx", quietly = TRUE)) install.packages("openxlsx")

library(readxl)
library(writexl)
library(dplyr)
library(CRISclassifier)

file_path <- "C:/Users/Vaishnavi Raikar/AppData/Roaming/Microsoft/Windows/Network Shortcuts/patient1.xlsx"

final_data <- read_excel(file_path)

# Convert the data to a tibble if it's not already
final_data_1 <- as_tibble(final_data)

# Convert tibble to data frame to set row names
final_data_1 <- as.data.frame(final_data_1)

# Set the Entrez ID as row names
rownames(final_data_1) <- final_data$Gene
final_data_1 <- final_data_1 %>% dplyr::select(-Gene)

#matrix conversion
expression_matrix <- as.matrix(final_data_1)

# Perform CRIS classification using predictCRISclassKTSP function
cris_results <- predictCRISclassKTSP(expression_matrix)

# Print results
print(cris_results)

```
```{r}
if (!requireNamespace("readxl", quietly = TRUE)) install.packages("readxl")
library(readxl)

install.packages("ggplot2")
library("ggplot2")

if (!requireNamespace("tidyr", quietly = TRUE)) install.packages("tidyr")
library(tidyr)


# Define the path to the uploaded file
file_path <- "C:/Users/Vaishnavi Raikar/OneDrive/Desktop/MAJOR THESIS - VAISHNAVI/cris_plot.xlsx"

# Read the data from the Excel file
cris_results <- read_xlsx(file_path)

# Reshape the data for plotting
cris_long <- cris_results %>%
  pivot_longer(cols = c(starts_with("CRIS"), "NA"), names_to = "CRIS", values_to = "Count")

# Define colors for each CMS group
cris_colors <- c("CRISA" = "#1f77b4", "CRISB" = "#ff7f0e", "CRISC" = "#2ca02c", "CRISD" = "#d62728", "CRISE" = "pink", "NA" = "grey")

# Create the bar plot
ggplot(cris_long, aes(x = Sample_Names, y = Count, fill = CRIS)) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_manual(values = cris_colors) +
  labs(title = "CRIS Counts per Patient Group",
       x = "Patient Group",
       y = "Count",
       fill = "CMS") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

