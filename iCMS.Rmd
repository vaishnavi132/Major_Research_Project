---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
if(!requireNamespace("devtools", quietly = TRUE)) {
  install.packages("devtools")
}
library(devtools)

# Install the package from GitHub
devtools::install_github('CRCrepository/iCMS.SSC', force = TRUE)

```


```{r}

if (!requireNamespace("writexl", quietly = TRUE)) install.packages("writexl")
if (!requireNamespace("readxl", quietly = TRUE)) install.packages("readxl")
if (!requireNamespace("openxlsx", quietly = TRUE)) install.packages("openxlsx")

library(readxl)
library(writexl)
library(dplyr)

file_path <- "C:/Users/Vaishnavi Raikar/Downloads/In house dataset.xlsx"

final_data <- read_excel(file_path)

# Convert the data to a tibble if it's not already
final_data_1 <- as_tibble(final_data)

# Convert tibble to data frame to set row names
final_data_1 <- as.data.frame(final_data_1)

rownames(final_data_1) <- final_data$Gene
final_data_1 <- final_data_1 %>% dplyr::select(-Gene)

# Matrix conversion
expression_matrix <- as.matrix(final_data_1)

# Use lapply instead of mclapply
icms_results <- lapply(1:ncol(expression_matrix), function(z) iCMS.KNN(expression_matrix[, z]))

# Print results
print(icms_results)

```


```{r}

if (!requireNamespace("readxl", quietly = TRUE)) install.packages("readxl")
library(readxl)

install.packages("ggplot2")
library("ggplot2")

if (!requireNamespace("tidyr", quietly = TRUE)) install.packages("tidyr")
library(tidyr)


file_path <- "C:/Users/Vaishnavi Raikar/OneDrive/Desktop/MAJOR THESIS - VAISHNAVI/iCMS_plot.xlsx"

icms_results <- read_xlsx(file_path)

#plotting the data 
icms_long <- icms_results %>%
  pivot_longer(cols = c(starts_with("iCMS"), "NA"), names_to = "iCMS", values_to = "Count")

# Define colors for each CMS group
icms_colors <- c("iCMS2" = "#1f77b4", "iCMS3" = "yellow", "NA" = "grey" ) 

# Create the bar plot
ggplot(icms_long, aes(x = Sample_Names, y = Count, fill = iCMS)) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_manual(values = icms_colors) +
  labs(title = "ICMS Counts per Patient Group",
       x = "Patient Group",
       y = "Count",
       fill = "CMS") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}


```

